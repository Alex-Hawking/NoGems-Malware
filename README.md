# NoGems?

<img src="report/images/ng_logo.png" alt="NoGems Logo" style="height:350px;">

## Overview

**NoGems?** is a multi-platform, persistent, evasive, and mutating malware developed in ***24 hours*** as part of a lab exercise in the **University of Western Australia's CITS3006 Penetration Testing Unit**. The malware is designed to infect both Windows and Debian-based operating systems, demonstrating techniques commonly used by malicious software to achieve persistence, evade detection, and exfiltrate data.

This project is for educational purposes, showcasing how malware can be created and analyzed. The keylogging malware implements basic features, such as establishing persistence, cloning itself, mutating to avoid detection, and securely transmitting captured data to a remote server.

> **Note**: While the malware and report was created within a 24-hour period, the production listener and compiled executables have been modified slightly to safely exfiltrate to the externally hosted listener, additional cleanup and formatting has also been applied to the source code.

For a more in-depth analysis of the NoGems? malware, please refer to the accompanying [report](https://github.com/Alex-Hawking/nogems-malware/blob/main/nogems.pdf). The report offers a detailed examination of the malwareâ€™s behavior, including the common traits it exhibits, such as persistence and obfuscation techniques, as well as recommended remediation strategies. This report serves as a valuable educational resource for those looking to understand the methods used by malicious software and how to effectively mitigate such threats.

## How to Run

### Prerequisites

- **Python 3.8+** installed on your system.
- **Virtual machine to install and run the malware (Windows/Debian based)** (recommended).

### Setup

The following steps explain how to locally host the platform for downloading the malware onto the victim's VM.

1. **Clone the Repository**:
   ```bash
   git clone https://github.com/Alex-Hawking/nogems-malware.git
   cd nogems/attacker/web
   ```

2. **Create and Activate a Virtual Environment:**:
   ```bash
    python -m venv venv
    venv/Scripts/activate  # On Windows
    source venv/bin/activate  # On Linux/Mac
   ```

3. **Install Required Packages:**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Configure VM settings:**
    Ensure your VM is able to access the server running on your host by configuring the network settings as follows:

   - **Network Adapter**: Set to **Bridged Adapter** to allow the VM to be on the same network as your host machine.
   - **Promiscuous Mode**: Ensure that the VM can communicate with the host and other devices on the network.
   - **IP Configuration**: Ensure that the VM receives an IP address on the same subnet as your host machine, either through DHCP or by manually assigning an IP address.

   This configuration will allow the VM to access the web server running on your host machine for downloading the malware and exfiltrating data to the external listener.

   It is also recommended to save a 'pre malware' snapshot of your VM, to easily revert VM states.

### Running the malware

**On the host machine**
1. **Run the download site:**

    (from within `attacker/web`)
    ```
    python3 app.py
    ```

**On the victim VM:**
1. **Navigate to the website and download malware:**
    Copy and past the appropriate address displayed in the program output into your VM's browser and download the malware onto the victim machine.

2. **Run the malware:**
   
    (*NOTE: on Windows Defender must be disabled*)
   
    **Windows:** Navigate to the program and run it as you would any other exe, it should prompt for admin priviledges.
   
    **Debian:** 
    1. Make the download executable: `chmod +x /path/to/malware`
    2. Run with *sudo*: `sudo ./path/to/malware`

5. **Interact with NoGems?:**
    Once the malware is running all keystrokes will be exfiltrated and displayed on:
    > [https://nogemsmalware.duckdns.org/](https://nogemsmalware.duckdns.org/)

    (this site updates logs every 5 seconds so there may be some delay)

    For further analysis, see the source code and report to see what other behaviour is exhibited by NoGems, a brief rundown is below.

### Alternate Methods

- The Python code for the malware can be bundled into an executable using PyInstaller. This option allows you to customize the code and host the exfiltration endpoint yourself, though it requires additional setup and technical know-how.
- The listener can be hosted locally using the source code provided in the repository. This method gives you full control over the environment, making it ideal for scenarios where you prefer to keep the entire setup within your local network.
- Precompiled executables for both Windows and Debian-based systems are available for download from the [GitHub Releases](https://github.com/Alex-Hawking/nogems-malware/releases/tag/dist). These ready-to-use executables can be run directly on the victim VM without the need for further compilation.


## General Lifecycle

1. **Initial Distribution**: The malware is distributed through social engineering techniques, disguised as a tool for obtaining free in-game resources. Users are lured into downloading the malware, believing it to be a legitimate application.
2. **Execution**: Upon execution, the malware checks for the necessary privileges, clones itself to a hidden location on the system, and modifies its code to avoid detection. It then sets up mechanisms to ensure it runs automatically at startup.
3. **Obfuscation and Mutation**: The malware's code is obfuscated using PyArmor, and it is compiled into an executable with PyInstaller. Each time the malware runs, it mutates by making slight modifications to its code, helping it evade detection by signature-based security tools.
4. **Persistence Mechanisms**: NoGems? ensures its persistence by modifying system settings, such as creating registry entries on Windows or `systemd` services on Debian-based systems. This guarantees that the malware will execute every time the system is restarted.
5. **Keylogging and Data Exfiltration**: The primary function of NoGems? is to capture keystrokes on the infected system. These captured keystrokes are securely exfiltrated to a remote server hosted on a public domain, accessible at [https://nogemsmalware.duckdns.org/](https://nogemsmalware.duckdns.org/). This allows real-time monitoring of the victim's keystrokes.
6. **User Notification**: After every ten keystrokes, the malware triggers a notification, informing the user that their keystrokes are being logged. This feature is intended to highlight the educational purpose of this malware demonstration.
7. **Self-Destruction**: Once the malware has cloned itself and modified its code, the original file is deleted to minimize traces of its presence and reduce the risk of detection.
8. **Reinjection into Startup**: To maintain ongoing activity, the malware re-adds itself to the system's startup sequence every time it is executed, ensuring that it remains persistent across reboots.

For detailed information on the NoGems? malware please see [this report](https://github.com/Alex-Hawking/nogems-malware/blob/main/nogems_malware_analysis.pdf).

### Security Note

The production listener and compiled executables have been modified to include security features to prevent trivial exploitation. The malware exfiltrates keystrokes to a publicly accessible domain, [https://nogemsmalware.duckdns.org/](https://nogemsmalware.duckdns.org/), for demonstration purposes. These modifications ensure that the project is used safely and ethically as an educational tool.

### Disclaimer

This project is strictly for educational purposes and should not be used in any real-world attacks or malicious activities. The intention is to demonstrate how malware operates and to provide insights into the techniques used by malicious software. The exfiltration of data to a public domain serves as an example and should not be replicated in any malicious context.
