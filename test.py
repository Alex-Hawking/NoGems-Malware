import os
import subprocess

def get_top_user():
    # Use the `w` command to find the top user (the first user listed)
    try:
        output = subprocess.check_output("w -h | awk '{print $1}' | head -n 1", shell=True)
        return output.decode().strip()
    except Exception as e:
        log_message(f"Failed to determine top user: {e}")
        return None


def send_notification(title, message):
    user = get_top_user()
    if user:
        try:
            # Send notification to the top user using notify-send
            command = f'sudo -u {user} DISPLAY=:0 DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$(id -u {user})/bus notify-send "{title}" "{message}"'
            subprocess.run(command, shell=True, check=True)
        except Exception as e:
            print(f"Failed to send notification due to: {e}")
    else:
        print("No user available to send notification.")

send_notification("test", "test")